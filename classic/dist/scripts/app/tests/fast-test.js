define(["underscore","jquery","parse","../models/Vampire","backbone","marionette","../models/Troupe","../models/SimpleTrait","../testsiteconfig","../models/Werewolf"],function(e,t,n,o,i,c,a,l,u,r){jasmine.DEFAULT_TIMEOUT_INTERVAL=6e4;var s=function(){n.$=t,n.initialize("APPLICATION_ID","yymp8UWnJ7Va32Y2Q4uzvWxfPTYuDvZSA8kdhmdR"),n.serverURL=u.serverURL},f=[{name:"Vampire",template:o},{name:"Werewolf",template:r}];describe("A suite",function(){it("contains spec with an expectation",function(){expect(!0).toBe(!0)})});var g=function(){return s(),e.eq(n.User.current().get("username"),"devuser")?n.Promise.as(n.User.current()):n.User.logIn("devuser","thedumbness")};describe("Parse",function(){beforeAll(function(){s(),n.User.current()&&n.User.logOut()}),it("isn't logged in",function(){expect(n.User.current()).toBe(null)}),it("can fail to log in",function(e){n.User.logIn("devuser","thewrongness").then(function(t){e.fail("Logged in with bad password")},function(t,n){e(n)})}),it("can log in",function(e){n.User.logIn("devuser","thedumbness").then(function(t){e()},function(t,n){e.fail(n)})})}),e.each([f[0]],function(t){describe("A "+t.name+"'s long texts",function(){var n,o;beforeAll(function(e){g().then(function(){return t.template.create_test_character("longtexts"+t.name)}).then(function(e){return o=5,t.template.get_character(e.id)}).then(function(t){n=t,e()},function(t){e.fail(t)})}),it("return null when getting non-existent",function(e){n.get_long_text("some ridiculous thing we'd never have").then(function(t){expect(t).toBe(null),e()}).fail(function(t){e.fail(t)})}),it("return null when removing non-existent",function(e){n.remove_long_text("some ridiculous thing we'd never have").then(function(t){expect(t).toBe(null),e()}).fail(function(t){e.fail(t)})}),it("can be updated",function(e){var t="I'm awesome";n.update_long_text("background",t).then(function(e){return expect(e).toBeDefined(),expect(e.get("owner").id).toBe(n.id),expect(e.get("text")).toEqual(t),expect(e.get("category")).toEqual("background"),expect(n.has_fetched_long_text("background")).toBe(!0),n.has_long_text("background")}).then(function(t){expect(t).toBe(!0),e()}).fail(function(t){e.fail(t)})}),it("can be removed",function(e){var t="Nothing extra needed";n.update_long_text("something_else",t).then(function(e){return expect(e).toBeDefined(),expect(e.get("owner")).toBe(n),expect(e.get("text")).toEqual(t),expect(e.get("category")).toEqual("something_else"),expect(n.has_fetched_long_text("something_else")).toBe(!0),n.has_long_text("something_else")}).then(function(e){return expect(e).toBe(!0),n.remove_long_text("something_else")}).then(function(){return expect(n.has_fetched_long_text("something_else")).toBe(!1),n.has_long_text("something_else")}).then(function(e){return expect(e).toBe(!1),n.get_long_text("something_else")}).then(function(t){expect(t).toBe(null),e()}).fail(function(t){e.fail(t)})}),it("can be cleared to save memory",function(e){n.update_long_text("extra_printed","The clocks only come out at nine").then(function(t){expect(n.has_fetched_long_text("extra_printed")).toBe(!0),n.free_fetched_long_text("extra_printed"),expect(n.has_fetched_long_text("extra_printed")).toBe(!1),e()}).fail(function(t){e.fail(t)})}),it("notifies when updated",function(t){var o="I'm awesome",c=i.View.extend({initialize:function(){e.bindAll(this,"finish")},finish:function(e){this.stopListening(),expect(e).toBeDefined(),expect(e.get("owner").id).toBe(n.id),expect(e.get("text")).toEqual(o),expect(e.get("category")).toEqual("background"),expect(n.has_fetched_long_text("background")).toBe(!0),n.has_long_text("background").then(function(e){expect(e).toBe(!0),t()}).fail(function(e){t.fail(e)})}}),a=new c;a.listenTo(n,"change:longtextbackground",a.finish),n.update_long_text("background",o).fail(function(e){t.fail(e)})}),it("notifies when removed",function(t){var o="I'm awesome",c=i.View.extend({initialize:function(){e.bindAll(this,"finish")},finish:function(e){this.stopListening(),expect(n.has_fetched_long_text("something_else")).toBe(!1),n.has_long_text("something_else").then(function(e){return expect(e).toBe(!1),n.get_long_text("something_else")}).then(function(e){expect(e).toBe(null),t()}).fail(function(e){t.fail(e)})}}),a=new c;n.update_long_text("something_else",o).then(function(){return a.listenTo(n,"change:longtextsomething_else",a.finish),n.remove_long_text("something_else",{update:!1})}).fail(function(e){t.fail(e)})})})})});