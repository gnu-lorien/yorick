define(["jquery","backbone","parse","../helpers/Progress","../helpers/PromiseFailReport","../helpers/DescriptionFetcher"],function(e,t,r,c,i,n){var a=t.View.extend({initialize:function(){_.bindAll(this,"register","update_collection_query_and_fetch")},register:function(e,t,c,i){var a=this,o=!1;a.redirect!==i&&(a.redirect=i,o=!0),c!==a.targetValue&&(a.targetValue=c,o=!0),e!==a.character&&(a.character&&a.stopListening(a.character),a.character=e,a.listenTo(a.character,"change:"+t,a.update_collection_query_and_fetch),o=!0);var l=r.Promise.as();return t!=a.category&&(a.category=t,a.stopListening(a.character),a.listenTo(a.character,"change:"+t,a.update_collection_query_and_fetch),a.collection&&a.stopListening(a.collection),a.collection=n(t),a.listenTo(a.collection,"add",a.render),a.listenTo(a.collection,"reset",a.render),l=a.update_collection_query_and_fetch(),o=!0),o?l.then(function(){return a.render()}):l.then(function(){return a})},update_collection_query_and_fetch:function(){var e=this;return c("Fetching "+e.category),e.collection.fetch_avoiding_wait().done(function(){c()}).fail(i)},render:function(){return this.template=_.template(e("script#simpletextcategoryDescriptionItems").html())({collection:this.collection,character:this.character,category:this.category,targetValue:this.targetValue}),this.$el.find("div[role='main']").html(this.template),this.$el.enhanceWithin(),this},events:{"click .simpletext":"clicked"},clicked:function(t){var r=this;return e.mobile.loading("show"),r.character.update_text(r.targetValue,e(t.target).attr("name")).done(function(e){window.location.hash=r.redirect}),!1}});return a});