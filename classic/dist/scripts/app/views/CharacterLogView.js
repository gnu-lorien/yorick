define(["jquery","backbone","moment","../models/VampireChange","../collections/VampireChangeCollection","../models/Vampire"],function(e,t,n,a,c,i){var r=t.View.extend({initialize:function(){var e=this;this.collection=new c,e.listenTo(e.collection,"add",e.render),e.listenTo(e.collection,"reset",e.render),e.start=0,e.changeBy=10},register:function(e,t,n){var a=this,c=!1;return t=_.parseInt(t),n=_.parseInt(n),t!=a.start&&(a.start=t,c=!0),n!=a.changeBy&&(a.changeBy=n,c=!0),e!==a.character&&(a.character&&a.stopListening(a.character),a.character=e,a.listenTo(a.character,"change:change_count",a.update_collection_query_and_fetch),c=!0),c&&a.update_collection_query_and_fetch(),a},events:{"click .previous":"previous","click .next":"next","click .hackupdateowner":"hackupdateowner","click .hackdeleteoriginal":"hackdeleteoriginal"},previous:function(){var t=this,n=this.start-this.changeBy;this.start=_.max([0,n]),window.location.hash="#character/"+t.character.id+"/log/"+this.start+"/10",e.mobile.loading("show"),this.update_collection_query_and_fetch().then(function(){e.mobile.loading("hide")})},next:function(){var t=this;this.start+=t.changeBy,window.location.hash="#character/"+t.character.id+"/log/"+this.start+"/10",e.mobile.loading("show"),this.update_collection_query_and_fetch().then(function(){e.mobile.loading("hide")})},hackupdateowner:function(){var e=this,t=[],a=n(new Date("Sat Jun 18 2016 09:27:53 GMT -400 (Eastern Daylight Time)"));_.forEachRight(e.collection.models,function(e,c){var i=n(e.createdAt);i.isSame(a,"day")&&t.push(e)}),e.collection.reset(t),i.get_character("RT8FXNL8P2").then(function(e){return _.each(t,function(t){t.set("owner",e)}),Parse.Object.saveAll(t)}).then(function(){console.log("Saved")}).fail(function(e){console.error(e.message)})},hackdeleteoriginal:function(){var e=this,t=[],a=n(new Date("Sat Jun 18 2016 09:27:53 GMT -400 (Eastern Daylight Time)"));_.forEachRight(e.collection.models,function(e,c){var i=n(e.createdAt);i.isSame(a,"day")&&t.push(e)}),e.collection.reset(t),Parse.Object.destroyAll(t).then(function(){console.log("Deleted")}).fail(function(e){console.error(e.message)})},update_collection_query_and_fetch:function(){var e=this,t={reset:!0},n=new Parse.Query(a);return n.equalTo("owner",e.character).addDescending("createdAt"),n.skip(e.start),n.limit(e.changeBy),e.collection.query=n,e.collection.fetch(t)},format_entry:function(e,t){if(e.get(t))return e.get(t);var a=e[t];return _.isDate(a)?n(a).format("lll"):a},render:function(){return this.template=_.template(e("script#characterLogView").html())({character:this.character,logs:this.collection.models,format_entry:this.format_entry}),this.$el.find("div[role='main']").html(this.template),this.$el.enhanceWithin(),this}});return r});