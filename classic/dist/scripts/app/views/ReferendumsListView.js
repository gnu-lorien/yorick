define(["underscore","jquery","backbone","text!../templates/referendums-list.html","parse","../collections/Referendums","../helpers/PromiseFailReport"],function(e,t,r,i,n,l,s){var o=r.View.extend({initialize:function(){e.bindAll(this,"render","register"),this.collection=new l,this.listenTo(this.collection,"add remove reset",this.render)},register:function(t,r){var i,l=this;if(t=t||"#referendum/<%= referendum_id %>",e.eq(t,l.base_url)||(l.base_url=t,i=!0),r=r||function(){},!e.eq(r,l.filter)){var o=[],c=new n.Query("Referendum");return c.select("id","name","portrait","shortdescription","order"),c.include("portrait"),r(c),c.each(function(e){o.push(e)}).then(function(){l.collection.reset(o)}).fail(s)}return n.Promise.as([])},events:{"click .referendum-listing":"clicked"},clicked:function(r){var i=this;r.preventDefault(),t.mobile.loading("show");var n=t(r.currentTarget).attr("backendId"),l=e.template(i.base_url)({referendum_id:n});window.location.hash=l},render:function(){var t=this;return this.template=e.template(i)({collection:t.collection.models}),this.$el.find("div[role='referendums-list']").html(this.template),this.$el.enhanceWithin(),this}});return o});