define(["jquery","backbone","../models/SimpleTrait","../helpers/PromiseFailReport"],function(e,t,a,i){var r=t.View.extend({initialize:function(){_.bindAll(this,"remove","update_value","update_free_value","update_specialty_name","save_clicked","render_view")},register:function(e,t,i){var r=this,c=!1;return e!==r.character&&(r.character&&r.stopListening(r.character),r.character=e,r.listenTo(r.character,"change",r.render_view),c=!0),t!==r.simpletrait&&(r.simpletrait=t,r.fauxtrait=new a(r.simpletrait.attributes),c=!0),_.isEqual(i,r.category)||(r.category=i,c=!0),c?r.render():r},events:{"click .remove":"remove","change .value-slider":"update_value","change .free-slider":"update_free_value","change .cost-modifier-slider":"update_experience_modifier_value","change #specialize-name":"update_specialty_name","change #experience-type-select":"update_experience_type","click .save":"save_clicked"},remove:function(t){var a=this;return t.preventDefault(),a.undelegateEvents(),e.mobile.loading("show"),console.log("remove value",a.category,a.simpletrait),a.character.remove_trait(a.simpletrait).fail(i).always(function(){window.location.hash="#simpletraits/"+a.category+"/"+a.character.id+"/all",a.delegateEvents()}),!1},update_value:function(e,t,a){var i=this;this.$(e.target).val();console.log("update value",i.category,i.fauxtrait,this.$(e.target).val()),this.fauxtrait.set("value",_.parseInt(this.$(e.target).val())),i.render_view()},update_free_value:function(e,t,a){var i=this;this.$(e.target).val();this.fauxtrait.set("free_value",_.parseInt(this.$(e.target).val())),i.render_view()},update_experience_modifier_value:function(e,t,a){var i=this,r=this.$(e.target).val();this.fauxtrait.set("experience_cost_modifier",_.parseInt(r)),i.render_view()},update_specialty_name:function(e){var t=this;this.$(e.target).val();t.fauxtrait.set_specialization(this.$(e.target).val()),t.render_view()},update_experience_type:function(e){var t=this,a=this.$(e.target)[0],i=a.options[a.selectedIndex].value;"automatic"==i&&(i=void 0),t.fauxtrait.set("experience_cost_type",i),_.isFinite(t.fauxtrait.get("experience_cost_modifier"))||t.fauxtrait.set("experience_cost_modifier",1),t.render_view()},save_clicked:function(t){var a=this;return t.preventDefault(),e.mobile.loading("show"),_.defer(function(){console.log("save clicked",a.category,a.fauxtrait);var e=void 0;if(_.has(a.simpletrait,"id")){var t={name:a.fauxtrait.get("name"),value:a.fauxtrait.get("value"),category:a.fauxtrait.get("category"),free_value:a.fauxtrait.get("free_value"),experience_cost_type:a.fauxtrait.get("experience_cost_type"),experience_cost_modifier:a.fauxtrait.get("experience_cost_modifier")};a.simpletrait.set(t),e=a.character.update_trait(a.simpletrait)}else e=a.character.update_trait(a.fauxtrait.get("name"),a.fauxtrait.get("value"),a.fauxtrait.get("category"),a.fauxtrait.get("free_value"),!0,a.fauxtrait.get("experience_cost_type"),a.fauxtrait.get("experience_cost_modifier"));e.then(function(e){console.log("asaved",a.category,e),window.location.hash="#simpletraits/"+a.category+"/"+a.character.id+"/all"},i)}),!1},render_view:function(){this.view_template=_.template(e("script#simpleTraitChangeView").html())({c:this.character,character:this.character,b:this.fauxtrait,trait:this.fauxtrait}),this.$el.find("#simpletrait-viewing").html(this.view_template)},render:function(){return this.template=_.template(e("script#simpleTraitChangeChange").html())({c:this.character,b:this.fauxtrait,category:this.category,traitmax:this.character.max_trait_value(this.fauxtrait)}),this.render_view(),this.$el.find("#simpletrait-changing").html(this.template),this.$el.find("#simpletrait-changing").enhanceWithin(),this}});return r});