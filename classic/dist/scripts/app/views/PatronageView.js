define(["jquery","backbone","marionette","backform","bootstrap-datepicker","moment","../helpers/UserWreqr"],function(e,t,n,a,r,s,o){var i=t.View.extend({initialize:function(t){var n=this;n.options=t;var r="MM/DD/YYYY",i="mm/dd/yyyy",l=n.model.clone();l.has("owner")?l.set("owner",l.get("owner").id):n.isNew=!0,l.has("paidOn")&&l.set("paidOn",s(l.get("paidOn")).format(r)),l.has("expiresOn")&&l.set("expiresOn",s(l.get("expiresOn")).format(r));var d=o.channel.reqres.request("all").map(function(e){return{label:""+e.get("username")+" "+e.get("realname")+" "+e.get("email"),value:e.id}});d.unshift({label:"Invalid",value:""}),n.form=new a.Form({el:n.$el,model:l,fields:[{name:"owner",label:"Owner",control:"select",options:d},{name:"paidOn",label:"Paid on",control:"datepicker",type:"text",options:{autoclose:!0,format:i}},{name:"expiresOn",label:"Expires on",control:"datepicker",type:"text",options:{autoclose:!0,format:i}},{name:"submit",control:"button",label:"Save Changes"}],events:{submit:function(t){var a=this;t.preventDefault(),a.fields.at(3).set({status:"",message:""}),a.model.errorModel.clear(),n.model.set({paidOn:s(a.model.get("paidOn"),r).toDate(),expiresOn:s(a.model.get("expiresOn"),r).toDate(),owner:new Parse.User({id:a.model.get("owner")})});var o=new Parse.ACL;o.setPublicReadAccess(!0),o.setPublicWriteAccess(!1),o.setRoleReadAccess("Administrator",!0),o.setRoleWriteAccess("Administrator",!0),n.model.setACL(o),n.model.save().then(function(){a.fields.at(3).set({status:"success",message:"Save completed"}),_.defer(function(){e("body").enhanceWithin()})}).fail(function(e){a.model.errorModel.set("owner",_.escape(e.message))})}}})},tagName:"form",render:function(){return this.form.render(),this.$el.enhanceWithin(),this}});return i});