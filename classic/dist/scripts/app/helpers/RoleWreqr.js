define(["jquery","underscore","parse","backbone","marionette","../collections/Users"],function(e,r,n,o,t,a){var i=o.Model.extend({initialize:function(){var e=this;e.channel=o.Wreqr.radio.channel("role"),e.roles=new o.Collection,o.Wreqr.radio.reqres.setHandler("role","get",function(r){return e.roles.get(r)}),o.Wreqr.radio.reqres.setHandler("role","all",function(){return e.roles})},get_current_roles:function(){var e=this;return e._updateRoleWrapper=e._updateRoleWrapper||n.Promise.as(),e._updateRoleWrapper=e._updateRoleWrapper.always(function(){if(r.eq(e.last_user_id,n.User.current().id))return n.Promise.as();e.last_user_id=n.User.current().id;var o=new n.Query(n.Role);return o.each(function(r){var o=r.getUsers(),t=o.query();return t.equalTo("objectId",n.User.current().id),t.each(function(n){e.roles.add(r)}).fail(function(e){console.log("Failed in promise for "+r.get("name"))})})}),e._updateRoleWrapper}});return new i});