define(["jquery","underscore","parse","hello","../helpers/InjectAuthData"],function(e,n,a,t,o){var r=function(e){return a.FacebookUtils.logIn("email").then(function(e){return t("facebook").api("/me")}).then(function(e){return a.Cloud.run("submit_facebook_profile_data",e)}).then(function(e){return new a.Query("UserFacebookData").get(e)}).then(function(e){var n=e.attributes,r=a.User.current();return console.log(r.get("authData").facebook.access_token),r.has("username")||r.set("username",n.name),r.has("email")||r.set("email",n.email),r.has("realname")||r.set("realname",n.name),o(r),console.log(r.get("authData").facebook.access_token),console.log(t("facebook").getAuthResponse().access_token),r.save()}).fail(function(e){return a.Promise.error(e)})};return r});