define(["underscore","parse","../collections/BNSCTDBS_KithRules"],function(t,e,n){var a=e.Object.extend("ChangelingBetaSliceCosts",{initialize:function(){var t=this;return t.KithRules=new n,t.KithRules.fetch().then(function(){return e.Promise.as(t)})},get_arts_affinities:function(e){var n=this,a=n.KithRules.get_arts_affinities(e),r=t.map(e.get("ctdbs_arts_affinities_links"),"attributes.name");return a=[].concat(a,r)},get_arts_affinities_for_kith:function(t){var e=this,n=e.KithRules.get_arts_affinities_for_kith(t);return n},art_is_affinity:function(e,n){var a=this,r=a.get_arts_affinities(e);return[]!=r&&t.any(r,function(e){return!!t.eq(e,n.get_base_name())||!!t.eq(e,n.get("name"))})},get_cost_table:function(e){return t.map(t.range(1,10),function(t){return t*e})},get_cost_on_table:function(e,n){return t.chain(e).take(n).sum().value()},get_trait_cost_on_table:function(t,e){var n=this,a=e.get("value"),r=e.get("free_value")||0,_=n.get_cost_on_table(t,a),i=n.get_cost_on_table(t,r);return _-i},get_generation_cost_table:function(){var t=this,e=t.get_cost_table(2);return e[0]=1,e},calculate_trait_cost:function(t,e){var n=this,a=e.get("category"),r=(e.get("name"),e.get("value")),_=e.get("free_value")||0,i=r-_;if("attributes"==a)return 3*i;if("ctdbs_arts"==a)return n.art_is_affinity(t,e)?n.get_trait_cost_on_table(n.get_cost_table(4),e):n.get_trait_cost_on_table(n.get_cost_table(6),e);if("ctdbs_merits"==a)return i;if("ctdbs_flaws"==a)return i*-1;if("backgrounds"==a)return n.get_trait_cost_on_table(n.get_cost_table(2),e);var s=t.seeming();if("skills"==a){var o;return o=s<3?n.get_cost_table(1):n.get_cost_table(2),n.get_trait_cost_on_table(o,e)}if("ctdbs_realms"==a){var c=t.realms().length;return n.get_cost_on_table(n.get_cost_table(8),c)}return 0}});return a});