define(["jquery","underscore","parse","backbone","../models/Patronage"],function(e,t,r,a,n){var d=r.Collection.extend({model:n,initialize:function(){var e=this;e.query=new r.Query(e.model)},comparator:function(e,r){var a,n,d=this;return t.has(d,"sortbycreated")?(a=r.createdAt,n=e.createdAt):(a=r.get("expiresOn"),n=e.get("expiresOn")),t.gt(a,n)?1:t.lt(a,n)?-1:0},fetch:function(e){var a=this,e=e||{};t.defaults(e,{add:!0,update:!0});var n=a.query;if(e.update&&0!=a.models.length){var d=t.map(a.models,"createdAt");d=t.sortBy(d),n.greaterThan("createdAt",t.last(d))}var o=[];return n.each(function(e){o.push(e)}).then(function(){return e.add?t.each(o,function(e){a.add(e)}):a.reset(o),r.Promise.as(a)})}});return d});